!function(m,t,e,s){var a="flatWeatherPlugin",i={location:"Boston, MA",country:"USA",zmw:"02108.1.99999",displayCityNameOnly:!1,api:"openweathermap",forecast:5,apikey:"",view:"full",render:!1,loadingAnimation:!0,strings:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],min:"Min",max:"Max",direction:["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"]},timeformat:"12",lang:"EN"},r={openweathermap:["https://api.openweathermap.org/data/2.5/weather","https://api.openweathermap.org/data/2.5/forecast/daily"],wunderground:["https://api.wunderground.com/api/apikey/conditions/forecast/astronomy/"]};function n(t,e){this.element=t,this.settings=m.extend({},i,e),this.settings.units&&"auto"!=this.settings.units||(this.settings.units=-1==["united states","usa","united states of america","us"].indexOf(this.settings.country.toLowerCase())?"metric":"imperial"),this.settings.forecast=Math.min(this.settings.forecast,5),"wunderground"==this.settings.api&&(this.settings.forecast=Math.min(this.settings.forecast,3)),this._name=a,this.once=!1,this.init()}function p(t,e){return e[t.getDay()]}function c(t,e){var s=(t=new Date(1e3*t)).getHours(),a=t.getMinutes(),i=12<=s?"PM":"AM";return"24"==e&&(i="",s=s<10?"0"+s:s),"12"==e&&(s%=12),(s=s||12)+":"+(a=a<10?"0"+a:a)+" "+i}m.extend(n.prototype,{init:function(){this.settings.render&&(this.settings.loadingAnimation&&!this.once&&(this.loading=m("<div/>",{id:"flatWeatherLoading",class:"wi loading"}),this.loading.appendTo(this.element)),this.fetchWeather().then(this.render,this.error)),this.once=!0},fetchWeather:function(){var s=this,a=new m.Deferred,t=[],e=this.settings.location+" "+this.settings.country;if("openweathermap"==this.settings.api){var i={};this.settings.lat&&this.settings.lon?(i.lat=this.settings.lat,i.lon=this.settings.lon):i.q=e,i.units=this.settings.units,this.settings.apikey&&(i.appid=this.settings.apikey),this.settings.lang&&(i.lang=this.settings.lang),t.push(i),i.cnt=this.settings.forecast+1,t.push(i)}else"wunderground"==this.settings.api&&(r[this.settings.api][0]=r[this.settings.api][0].replace(/apikey/,this.settings.apikey));for(var n=[],o=0;o<r[this.settings.api].length;o++)"wunderground"==this.settings.api?n.push(m.get(r[this.settings.api][o]+"lang:"+this.settings.lang+"/q/zmw:"+this.settings.zmw+".json")):n.push(m.get(r[this.settings.api][o],t[o]));return m.when.apply(this,n).done(function(){var t=Array.prototype.slice.call(arguments);if(t=1<n.length?t.map(function(t){return t[0]}):t[0],"openweathermap"!=s.settings.api||"200"==t[0].cod&&"200"==t[1].cod)if("wunderground"==s.settings.api&&t.response&&t.response.error)console.log("Error interacting with the wunderground api see error object below for details:"),console.log(t),a.reject(t,s);else{var e=function(t,e){var s={};if("openweathermap"==e.api){""!=t[0].name?(s.location=t[0].name+", "+t[0].sys.country,s.city=t[0].name):""!=t[1].city.name?(s.location=t[1].city.name+", "+t[1].city.country,s.city=t[1].city.name):(s.location=e.location+", "+e.country,s.city=e.location),s.today={},s.today.temp={},s.today.temp.now=Math.round(t[0].main.temp),s.today.temp.min=Math.round(t[0].main.temp_min),s.today.temp.max=Math.round(t[0].main.temp_max),s.today.desc=t[0].weather[0].description.capitalize(),s.today.code=t[0].weather[0].id,s.today.wind=t[0].wind,s.today.humidity=t[0].main.humidity,s.today.pressure=t[0].main.pressure,s.today.sunrise=c(t[0].sys.sunrise,e.timeformat),s.today.sunset=c(t[0].sys.sunset,e.timeformat),s.today.day=p(new Date,e.strings.days),s.forecast=[];for(var a=0;a<e.forecast;a++){var i={};i.day=p(new Date(1e3*t[1].list[a].dt),e.strings.days),i.code=t[1].list[a].weather[0].id,i.desc=t[1].list[a].weather[0].description.capitalize(),i.temp={max:Math.round(t[1].list[a].temp.max),min:Math.round(t[1].list[a].temp.min)},s.forecast.push(i)}}else if("wunderground"==e.api){var n={chanceflurries:"600",chancerain:"500",chancesleet:"611",chancesnow:"600",chancetstorms:"200",clear:"800",cloudy:"802",flurries:"600",fog:"741",hazy:"721",mostlycloudy:"802",mostlysunny:"802",partlycloudy:"802",partlysunny:"802",sleet:"611",rain:"501",snow:"601",sunny:"800",tstorms:"211",unknown:"951"};s.location=t.current_observation.display_location.full,s.city=t.current_observation.display_location.city,s.today={},s.today.temp={},"metric"==e.units?(s.today.temp.now=Math.round(t.current_observation.temp_c),s.today.temp.min=Math.round(t.forecast.simpleforecast.forecastday[0].low.celsius),s.today.temp.max=Math.round(t.forecast.simpleforecast.forecastday[0].high.celsius)):(s.today.temp.now=Math.round(t.current_observation.temp_f),s.today.temp.min=Math.round(t.forecast.simpleforecast.forecastday[0].low.fahrenheit),s.today.temp.max=Math.round(t.forecast.simpleforecast.forecastday[0].high.fahrenheit)),s.today.desc=t.current_observation.weather,s.today.code=n[t.current_observation.icon],s.today.wind={},"metric"==e.units?s.today.wind.speed=t.current_observation.wind_kph:s.today.wind.speed=t.current_observation.wind_mph,s.today.wind.deg=t.current_observation.wind_degrees,s.today.humidity=t.current_observation.relative_humidity,"metric"==e.units?s.today.pressure=t.current_observation.pressure_mb:s.today.pressure=t.current_observation.pressure_in;var o=t.sun_phase.sunrise.minute,r=t.sun_phase.sunset.minute;if("12"==e.timeformat){s.today.sunrise=t.sun_phase.sunrise.hour+":"+o+" AM";var d=t.sun_phase.sunset.hour%12;d=d||12,s.today.sunset=d+":"+r+" PM"}else s.today.sunrise=t.sun_phase.sunrise.hour+":"+o,s.today.sunset=t.sun_phase.sunset.hour+":"+r;s.today.day=p(new Date,e.strings.days),s.forecast=[];for(var a=0;a<e.forecast+1;a++){var i={};i.day=p(new Date(1e3*t.forecast.simpleforecast.forecastday[a].date.epoch),e.strings.days),i.code=n[t.forecast.simpleforecast.forecastday[a].icon],i.desc=t.forecast.simpleforecast.forecastday[a].conditions,"metric"==e.units?i.temp={max:Math.round(t.forecast.simpleforecast.forecastday[a].high.celsius),min:Math.round(t.forecast.simpleforecast.forecastday[a].low.celsius)}:i.temp={max:Math.round(t.forecast.simpleforecast.forecastday[a].high.fahrenheit),min:Math.round(t.forecast.simpleforecast.forecastday[a].low.fahrenheit)},s.forecast.push(i)}}return s}(t,s.settings);s._weather=e,m.data(s.element,"weather",e),a.resolve(e,s)}else console.log("Error interacting with the openweathermap api see error object below for details:"),console.log(t),a.reject(t,s)}).fail(function(t){a.reject(t,s)}),a},error:function(t,e){e||(e=this),e.settings.loadingAnimation&&e.settings.render&&e.loading.remove(),"openweathermap"==e.settings.api?t="200"!=t.responseJSON.cod?t.responseJSON.cod+" "+t.responseJSON.message+" See console log for details.":t.responseJSON.message+" See console log for details.":"wunderground"==e.settings.api&&(t=t.response.error.type+" See console log for details.");var s=m("<div/>",{class:"flatWeatherPlugin "+e.settings.view});return m("<h2/>").text("Error").appendTo(s),m("<p/>").text(t).appendTo(s),m(e.element).html(s),m(e.element)},render:function(t,e){e||(t=(e=this)._weather);var s="metric"==e.settings.units?"&#176;C":"&#176;F";e.settings.loadingAnimation&&e.settings.render&&e.loading.remove();var a=m("<div/>",{class:"flatWeatherPlugin "+e.settings.view});if(e.settings.displayCityNameOnly?m("<h2/>").text(t.city).appendTo(a):m("<h2/>").text(t.location).appendTo(a),"forecast"!=e.settings.view){var i=m("<div/>",{class:"wiToday"}),n=m("<div/>",{class:"wiIconGroup"});m("<div/>",{class:"wi wi"+t.today.code}).appendTo(n),m("<p/>",{class:"wiText"}).text(t.today.desc).appendTo(n),n.appendTo(i),m("<p/>",{class:"wiTemperature"}).html(t.today.temp.now+"<sup>"+s+"</sup>").appendTo(i),i.appendTo(a)}if("simple"!=e.settings.view){var o=m("<div/>",{class:"wiDetail"});if("partial"==e.settings.view&&m("<p/>",{class:"wiDay"}).text(t.today.day).appendTo(i),"partial"!=e.settings.view){"today"!=e.settings.view&&m("<p/>",{class:"wiDay"}).text(t.today.day).appendTo(o);var r=m("<ul/>",{class:"astronomy"}).appendTo(o);m("<li/>",{class:"wi sunrise"}).text(t.today.sunrise).appendTo(r),m("<li/>",{class:"wi sunset"}).text(t.today.sunset).appendTo(r);var d=m("<ul/>",{class:"temp"}).appendTo(o);m("<li/>").html(e.settings.strings.max+": "+t.today.temp.max+"<sup>"+s+"</sup>").appendTo(d),m("<li/>").html(e.settings.strings.min+": "+t.today.temp.min+"<sup>"+s+"</sup>").appendTo(d);var p=m("<ul/>",{class:"atmosphere"}).appendTo(o);m("<li/>",{class:"wi humidity"}).text(t.today.humidity).appendTo(p),m("<li/>",{class:"wi pressure"}).text(t.today.pressure).appendTo(p),m("<li/>",{class:"wi wind"}).text(function(t,e,s,a){var i=e;0<=i&&i<=11.25||348.75<i&&i<=360?i=a[0]:11.25<i&&i<=33.75?i=a[1]:33.75<i&&i<=56.25?i=a[2]:56.25<i&&i<=78.75?i=a[3]:78.75<i&&i<=101.25?i=a[4]:101.25<i&&i<=123.75?i=a[5]:123.75<i&&i<=146.25?i=a[6]:146.25<i&&i<=168.75?i=a[7]:168.75<i&&i<=191.25?i=a[8]:191.25<i&&i<=213.75?i=a[9]:213.75<i&&i<=236.25?i=a[10]:236.25<i&&i<=258.75?i=a[11]:258.75<i&&i<=281.25?i=a[12]:281.25<i&&i<=303.75?i=a[13]:303.75<i&&i<=326.25?i=a[14]:326.25<i&&i<=348.75&&(i=a[15]);i||(i="");return i+" "+t+" "+("metric"==s?"km/h":"mph")}(t.today.wind.speed,t.today.wind.deg,e.settings.units,e.settings.strings.direction)).appendTo(p),o.appendTo(i)}if("today"!=e.settings.view||"forecast"==e.settings.view){for(var c=m("<ul/>",{class:"wiForecasts"}),l="forecast"==e.settings.view?0:1;l<t.forecast.length;l++){var u=m("<li/>",{class:"wiDay"}).html("<span>"+t.forecast[l].day+"</span>").appendTo(c),h=m("<ul/>",{class:"wiForecast"}).appendTo(u);m("<li/>",{class:"wi wi"+t.forecast[l].code}).appendTo(h),m("<li/>",{class:"wiMax"}).html(t.forecast[l].temp.max+"<sup>"+s+"</sup>").appendTo(h),m("<li/>",{class:"wiMin"}).html(t.forecast[l].temp.min+"<sup>"+s+"</sup>").appendTo(h)}c.appendTo(a)}}return m(e.element).html(a),m(e.element)}}),m.fn[a]=function(e,t){return m.isFunction(n.prototype[e])?this.data("plugin_"+a)[e](t):this.each(function(){if(!m.data(this,"plugin_"+a)){var t=new n(this,e);return m.data(this,"plugin_"+a,t)}})},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}}(jQuery,window,document);